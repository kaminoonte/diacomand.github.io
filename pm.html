
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Record Online Player Mini</title>

<script src="//www.radiorecord.ru/cdn-cgi/apps/head/6M5gzNKdGC0brTdt2lpQos4w9u4.js"></script><link href="/i/fonts/record/css/record.css" rel="stylesheet">
<link href="//www.radiorecord.ru/player-mini/style.css?v=1235" rel="stylesheet">
<link rel="image_src" href="http://www.radiorecord.ru/logo300-300.jpg?test">
<meta property="og:url" content="http://radio.telepubl.ru" />
<meta property="og:title" content="Record Online Player Mini" />
<meta property="og:image" content="http://www.radiorecord.ru/logo300-300.jpg?test" />
<meta property="og:image:secure_url" content="https://www.radiorecord.ru/logo300-300.jpg?test" />
<img src="//www.radiorecord.ru/vk_pic.jpg" alt="Vkontakte record picture" style="position: absolute; top: -10000px; left: -10000px;">
<link rel="shortcut icon" href="//www.radiorecord.ru/player-mini/favicon.ico" />


<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
</head>
<body class="current-station-background-color">
<main>
<div class="image-wrapper">
<div class="fake-heading"></div>
<div class="image-toner current-station-background-color"></div>
<div class="controlls">
<div class="icon-station-backward pull-left"></div>
<div class="play-pause ready icon-station-play pull-left"></div>
<div class="icon-station-forward pull-right"></div>
</div>
</div>
<div class="trackinfo current-station-background-color current-station-font-color">
<div class="current-station-name"></div>
<div id="nowplay-artist" class="artist-name"></div>
<div id="nowplay-title" class="artist-title"></div>
</div>
<div id="volume-slider"></div>
</main>

<script src="//www.radiorecord.ru/js/jquery-1.11.2.min.js"></script>

<script src="//www.radiorecord.ru/bitrix/templates/flat-new/js/soundmanagerv297a-20150601/script/soundmanager2-nodebug-jsmin.js"></script>

<script src="//www.radiorecord.ru/i/js/jquery.Storage.js"></script>

<script src="//www.radiorecord.ru/bitrix/templates/flat-new/js/jquery.record.js"></script>
<script src="//www.radiorecord.ru/i/js/jquery-ui-1.11.4/jquery-ui.min.js"></script>

<script>
			
			if ( isMobile(/iPhone|iPad|iPod/i) ) $('#volume-slider').css('display','none');
		
			window.current_station = 0;
			if (getParameterByName('st')) { window.current_station = prefixes.indexOf(getParameterByName('st')); }
			var current_bitrate = 'hq';
			if (isMobile()) { current_bitrate = 'lq'; }
			var timeInterval = 1000;

			function update_views() {
				clearInterval(updaterIntervalID);

				$('.current-station-background-color').css('background-color', stations[prefixes[current_station]]['color']);
				$('.current-station-font-color').css('color', stations[prefixes[current_station]]['fcolor']);
				$('.current-station-name').html("<a href='/' target='_blank'>"+stations[prefixes[current_station]]['name']+"</a>");
				$('.current-station-icon').removeClass().addClass('icon-st-'+prefixes[current_station]).addClass('current-station-font-color current-station-icon');
				$('.current-station-border-color').css('border-color', stations[prefixes[current_station]]['bcolor']);
				$('.current-station-subject').html(stations[prefixes[current_station]]['text']);

				$(document).trigger('currentStationChanged', {'station': prefixes[current_station]});

				update_track_inline();
				start_updater();
			}

			function update_track_inline() {
				if (!$('#nowplay-artist').hasClass('block_to_update')) {
					$('#nowplay-artist').addClass('block_to_update');
					$.getJSON(stations[prefixes[current_station]]['link'], function(data) {
						var items = [];
						$.each(data, function(key, val) {
							if (key == 'artist' && $('#nowplay-artist').html() != val) {
								if (prefixes[current_station]=="mix") {
									val = "By "+ val;
									$('#nowplay-artist').html(val);
								}
								else{
									$('#nowplay-artist').fadeOut(function() { $('#nowplay-artist').html(val); });	$('#nowplay-artist').fadeIn(); }
								}
							if (key == 'title' && $('#nowplay-title').html() != val) { $('#nowplay-title').fadeOut(function() { $('#nowplay-title').html(val); });	$('#nowplay-title').fadeIn(); }
							if (isMobile()) {
								if (key == 'image100') {
									if (val == null) {
										$('.nowplay-big-image').html('<img src="//www.radiorecord.ru/bitrix/templates/flat-new/img/transparent.png" />').removeClass('valid');
										$('.fake-heading').css('background-image', 'url("png/'+prefixes[current_station]+'.png")').removeClass('hovered');
									}
									else {
										if ($('.nowplay-big-image img').attr('src') != val) {
											$('.nowplay-big-image').html('<img src="'+val+'" />').addClass('valid');
											$('.fake-heading').css('background-image', 'url("'+val+'")').addClass('hovered');
										}
									}
								}
							}
							else {
								if (key == 'image600') {
									if (val == null) {
										$('.nowplay-big-image').html('<img src="//www.radiorecord.ru/bitrix/templates/flat-new/img/transparent.png" />').removeClass('valid');
										$('.fake-heading').css('background-image', 'url("png/'+prefixes[current_station]+'.png")').removeClass('hovered');
									}
									else {
										if ($('.nowplay-big-image img').attr('src') != val) {
											$('.nowplay-big-image').html('<img src="'+val+'" />').addClass('valid');
											$('.fake-heading').css('background-image', 'url("'+val+'")').addClass('hovered');
										}
									}
								}
							}



							/*if (key == 'image100') {
								if (val == null) { $('#nowplay-image').html('<i style="color: '+stations[prefixes[current_station]]['fcolor']+';" class="icon-st-'+prefixes[current_station]+'"></i>').css('background-image', 'url(/bitrix/templates/flat-new/img/black40.png)').removeClass('valid'); }
								else { if ($('#nowplay-image img').attr('src') != val) { $('#nowplay-image').html('<img src="'+val+'" />').addClass('valid'); } }
							}
							if (key == 'image600') {
								if (val == null) {
									$('.nowplay-big-image').html('<img src="//www.radiorecord.ru/bitrix/templates/flat-new/img/transparent.png" />').removeClass('valid');
									$('.fake-heading').css('background-image', 'url("png/'+prefixes[current_station]+'.png")').removeClass('hovered');
								}
								else {
									if ($('.nowplay-big-image img').attr('src') != val) {
										$('.nowplay-big-image').html('<img src="'+val+'" />').addClass('valid');
										$('.fake-heading').css('background-image', 'url("'+val+'")').addClass('hovered');
									}
								}
							}*/
						});
					});
					$('#nowplay-artist').removeClass('block_to_update');
					$('#nowplay-image img').removeClass('loading');
				}
			}



			function start_updater() {
				window.updaterIntervalID = setInterval("update_track_inline();",5000);
			}



			$(document).on('click', '.play-pause.ready', function() {
				if ($(this).hasClass('icon-station-play')) {
					$(this).addClass('icon-station-pause').removeClass('icon-station-play');
					start_play(stations[prefixes[current_station]][current_bitrate]);
					update_views();
				}
				else {
					$(this).removeClass('icon-station-pause').addClass('icon-station-play');
					stop_play();
				}
			});

			$(document).on('click', '.icon-station-backward', function() {
				// play backward
				if (current_station == 0) { current_station = prefixes.length-1; }
				else { current_station--; }
				start_play(stations[prefixes[current_station]][current_bitrate]);
				$('.play-pause').addClass('icon-station-pause').removeClass('icon-station-play');
				update_views();
			});

			$(document).on('click', '.icon-station-forward', function() {
				// play forward
				if (current_station == prefixes.length-1) { current_station = 0; }
				else { current_station++; }
				start_play(stations[prefixes[current_station]][current_bitrate]);
				$('.play-pause').addClass('icon-station-pause').removeClass('icon-station-play');
				update_views();
			});

			function getParameterByName(name) {
				name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
				var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
				results = regex.exec(location.search);
				return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
			}

			$(function() {
				setTimeout(function() {
					//$('.play-pause.ready').trigger('click');
					//start_play(stations[prefixes[current_station]][current_bitrate]);

				}, 2000);
			})



			var slider = $('#volume-slider');
			slider.slider({
				range: "min",
				min: 1,
				max: 100,
				value: getVolume(),
				orientation: 'horizontal',
				start: function(event,ui) {},
				slide: function(event, ui) {
					var value = slider.slider('value');
					setVolume(value);
				},
				change: function(event, ui) {
					var value = slider.slider('value');
					setVolume(value);
				},
				stop: function(event,ui) {
					//tooltip.fadeOut('fast');
				},
			});


			window.currentInstance = new Date().getTime();
			/*
			setInterval(function(){

				if (window.localStorage.currentPlayer && window.localStorage.currentPlayer != window.currentInstance) {
					stop_play();

					$(".play-pause.ready").addClass('icon-station-play').removeClass('icon-station-pause');
				};

			}, 1000);
*/

			$(document).on('soundManagerReady', function() {
				window.updaterIntervalID = setInterval("update_track_inline();",5000);
				console.log('ready sm');
				if (!isMobile()) {
					$('.play-pause').trigger('click');
					start_play(stations[prefixes[current_station]][current_bitrate]);
				}

				//start_updater();
				update_views();

			});

			function isMobile($device){

					if ( !$device ) var $device =  /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;
					if( $device.test(navigator.userAgent) ) { return true; }
					else { return false; }
			}

		</script>
</body>
</html>
